<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Training words</title>
	<link rel="stylesheet" href="css/style.css">
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
	<header id="header">
		<h1>Learn new words!</h1>
	</header>

	<section id="main">
		<button onclick="view_dictionaries()">Start</button>	
	</section>

	<section id="dict">
		<p>Select the dictionary:</p>
		<div class="block-th">
			<button onclick='select_dictionary("first");'>First</button>
			<button onclick='select_dictionary("second");'>Second</button>
			<button onclick='select_dictionary("third");'>Third</button>
		</div>
		<div class="block-th">
			<button onclick='select_dictionary("fourth");'>Fourth</button>
			<button onclick='select_dictionary("fifth");'>Fifth</button>
			<button onclick='select_dictionary("sixth");'>Sixth</button>
		</div>
	</section>

	<section id="select_game">
		<p>Select the mode:</p>
		<button onclick="start_game_er()">En -> Ru</button>	
		<button onclick="start_game_re()">Ru -> En</button>	
	</section>

	<section id="game">
		<div class="parent">
			<div class="block">
				<p id="task">Translate this word:</p>
				<p id="word">word</p>
				<p id="pfs">(noun)</p>
				<form onsubmit="return false;" autocomplete="off">
					<input type="text" id="us_answer">
					<button onclick="select_handler();">check</button>
					<p id="counter">1/6</p>
				</form>
				<div class="icons">
					<a href="#" id="lingvo" target="_blank"><img src="img/lingvo.jpg" alt="image lingvo"></a>
					<a href="#" id="forvo" target="_blank"><img src="img/forvo.jpg" alt="image forvo"></a>
					<a href="#" id="reverso" target="_blank"><img src="img/reverso.jpg" alt="image reverso"></a>
				</div>
			</div>
		</div>
	</section>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script type="text/javascript">
		var jsonFile = new XMLHttpRequest();
		var url = "https://mcflydesigner.github.io/words/";

		jsonFile.onreadystatechange = function() {
			if (jsonFile.readyState == 4 && jsonFile.status == 200) {
		  		//alert(jsonFile.responseText);
		  		set_data_er(jsonFile.responseText);
		  		set_data_re(jsonFile.responseText);
		  }
		}

		var counter = -1;
		var game = -1;

		//R -> E
		var rstart = [];
		var rwords = [];
		let rcoll = new Map();
		let rpfs = new Map();

		//E -> R
		var estart = [];
		var ewords = [];
		let ecoll = new Map();
		let epfs = new Map();

		function select_dictionary(dictionary) {
			switch(dictionary) {
				case "first":
					window.url += "first.json";
					break;

				case "second":
					window.url += "second.json";
					break;

				default:
					alert("Словарика еще нет :)");
					break;
			}

			jsonFile.open("GET",url,true);
			jsonFile.send();
			view_games();
		}

		//View all dictionaries for user
		function view_dictionaries() {
			$("#main").fadeOut(500);
			$("#dict").fadeIn(2000);
		}

		//Select the game
		function view_games() {
			$("#dict").fadeOut(500);
			$("#select_game").fadeIn(2000);
		}

		//Sort of word list
		function compareRandom(a, b) {
			return Math.random() - 0.5;
		}

		//Handler for either games
		function select_handler() {
			if(game == 0) game_handle_re();
			else game_handle_er();
		}





		//=============================================================
		// 										Russian -> English
		//=============================================================
		function set_data_re(datajson) {
			data = JSON.parse(datajson);

			for(var i = 0; i < data.words.length; i++) {
				window.ewords.push(data.words[i][1][0]);
				window.estart.push(data.words[i][1][0]);
				ecoll.set(data.words[i][1][0], data.words[i][0]);
				var pofs = data.words[i][2];
				if(pofs == "verb") pofs = ["гл."];
				else if(pofs == "noun") pofs = ["сущ."];
				else pofs = ["прил."];
				epfs.set(data.words[i][1][0], pofs);
			}
		}

		//Start game
		function start_game_re() {
			game = 0;
			document.getElementById("header").style.display = "none";
			document.getElementById("main").style.display = "none";
			document.getElementById("select_game").style.display = "none";
			document.getElementById("word").style.fontWeight = "100";
			$("#game").fadeIn(1000);

			set_word_re();
		}

		//Button "next"
		function game_handle_re() {
			//handle mistakes
			var right_answer = ecoll.get(ewords[counter]);
			var flag = false;

			if(document.getElementById("us_answer").value.toLowerCase().trim() == right_answer.toLowerCase()) {
				document.getElementById("us_answer").style.background = "#57CE79";
				document.getElementById("us_answer").style.border = "1px solid #57CE79";
				document.getElementById("us_answer").style.color = "#fff";

				flag = true;
				setTimeout(function () {
					counter++;
					set_word_re();
				}, 1500);
			}

			if(!flag) {
					//alert("false");
					ewords.push(ewords[counter]);
					document.getElementById("us_answer").value = ecoll.get(ewords[counter]);
					document.getElementById("us_answer").style.background = "#D63C3C";
					document.getElementById("us_answer").style.border = "1px solid #D63C3C";
					document.getElementById("us_answer").style.color = "#fff";

					setTimeout(function () {
						counter++;
						set_word_re();
					}, 2000);
				} 
			}

		//Change the word
		function set_word_re() {
				//Restart game
				if(ewords[counter] == null) {
					//alert("restart");
					counter = 0;
					ewords = estart.slice();
					ewords.sort(compareRandom);
				} 

				document.getElementById("lingvo").href = "https://www.lingvolive.com/ru-ru/translate/en-ru/" + ecoll.get(ewords[counter]);
				document.getElementById("forvo").href = "https://ru.forvo.com/word/" + ecoll.get(ewords[counter]) + "/#en/";
				document.getElementById("reverso").href = "https://context.reverso.net/перевод/английский-русский/" + ecoll.get(ewords[counter]);

				document.getElementById("word").innerHTML = ewords[counter];
				document.getElementById("pfs").innerHTML = "(" + epfs.get(ewords[counter]) + ")";
				document.getElementById("us_answer").style.background = "none";
				document.getElementById("us_answer").style.border = "1px solid black";
				document.getElementById("us_answer").style.color = "black";
				document.getElementById("us_answer").value = "";
				document.getElementById("counter").innerHTML = (counter + 1) + "/" + ewords.length;
			}






		//=============================================================
		//										Enlgish -> Russian
		//=============================================================
		//Initialize all data from JSON file
		function set_data_er(datajson) {
			game = 1;
			data = JSON.parse(datajson);

			for(var i = 0; i < data.words.length; i++) {
				window.rwords.push(data.words[i][0]);
				window.rstart.push(data.words[i][0]);
				rcoll.set(data.words[i][0], data.words[i][1]);
				rpfs.set(data.words[i][0], data.words[i][2]);
			}
		}

		//Start game
		function start_game_er() {
			document.getElementById("header").style.display = "none";
			document.getElementById("main").style.display = "none";
			document.getElementById("select_game").style.display = "none";
			$("#game").fadeIn(1000);
			set_word_er();
		}


		//Button "next"
		function game_handle_er() {
			//handle mistakes
			var right_answers = rcoll.get(rwords[counter]);
			var flag = false;

			for(var i = 0; i < right_answers.length; i++) {
				if(document.getElementById("us_answer").value.toLowerCase().trim() == right_answers[i].toLowerCase()) {

					flag = true;

					document.getElementById("us_answer").style.background = "#57CE79";
					document.getElementById("us_answer").style.border = "1px solid #57CE79";
					document.getElementById("us_answer").style.color = "#fff";

					setTimeout(function () {
						counter++;
						set_word_er();
					}, 1500);

					break;
				}
			}

			if(!flag) {
					//alert("false");
					rwords.push(rwords[counter]);
					document.getElementById("us_answer").value = rcoll.get(rwords[counter]).join(",");
					document.getElementById("us_answer").style.background = "#D63C3C";
					document.getElementById("us_answer").style.border = "1px solid #D63C3C";
					document.getElementById("us_answer").style.color = "#fff";

					setTimeout(function () {
						counter++;
						set_word_er();
					}, 2000);
				} 
			}

			//Change the word
			function set_word_er() {
				//Restart game
				if(rwords[counter] == null) {
					//alert("restart");
					counter = 0;
					rwords = rstart.slice();
					rwords.sort(compareRandom);
				} 

				document.getElementById("lingvo").href = "https://www.lingvolive.com/ru-ru/translate/en-ru/" + rwords[counter];
				document.getElementById("forvo").href = "https://ru.forvo.com/word/" + rwords[counter] + "/#en/";
				document.getElementById("reverso").href = "https://context.reverso.net/перевод/английский-русский/" + rwords[counter];

				document.getElementById("word").innerHTML = rwords[counter];
				document.getElementById("pfs").innerHTML = "(" + rpfs.get(rwords[counter]) + ")";
				document.getElementById("us_answer").style.background = "none";
				document.getElementById("us_answer").style.border = "1px solid black";
				document.getElementById("us_answer").style.color = "black";
				document.getElementById("us_answer").value = "";
				document.getElementById("counter").innerHTML = (counter + 1) + "/" + rwords.length;
			}






			//Animation appear
			$("#header").fadeIn(800);
			$("#main").fadeIn(1000);
		</script>
	</body>
	</html>


