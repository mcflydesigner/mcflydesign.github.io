<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Training words</title>
	<link rel="stylesheet" href="css/style.css">
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

	<!-- FAQ section -->
	<section id="faq">
		<button onclick="show('block')"><img src="img/faq.png" alt="faq icon"></button>
		<div id="wrap" onclick="show('none')">
			<div id="window">
				<h1>FAQ</h1>
				<p class="ask line_up">What is it?</p>
				<p class="answer f_answer line_down">It's a service for people or students who learn English. They can remember words easily!</p>
				<p class="ask nask">1.Can I start?</p>
				<p class="answer">Press "start" and you can choose a dictionary from the list! Then you can choose a mode of the game. There are two options: from English to Russian or from Russian to English.</p>
				<p class="example">Example(GIF):</p>
				<img class="gif" src="img/start.gif" alt="GIF image example">
				<p class="ask nask">2.How to control the game?</p>
				<p class="answer">You can do it only by your keyboard! If you wanna press "check", you can press "enter" on your keyboard. Or if you wanna press "know", you can press "right shift" or "left shift" on your keyboard.</p>
				<p class="example">Example(Image):</p>
				<img src="img/keyboard.png" alt="keyboard image">
				<p class="ask nask">3.How to play the game?</p>
				<p class="answer">If you know word, you should press "know". Otherwise you should press "check" and then the program checks it.If you're right, your input will be green. And your input will be red, if you aren't right.</p>
				<p class="example">Example(GIF):</p>
				<img class="gif" src="img/game.gif" alt="GIF image example">
				<h2>Thank you! Have a nice game :)</h2>
			</div>
		</div>
	</section>
	<!-- End FAQ section -->

	<!-- Main block -->
	<header id="header">
		<h1>Learn new words!</h1>
	</header>
	<!-- End Main block -->
	
	<!-- Button start -->
	<section id="main">
		<button onclick="view_dictionaries()">Start</button>	
	</section>
	<!-- End Button start -->
	
	<!-- Dictionaries section -->
	<section id="dict">
		<p>Select the dictionary:</p>
		<div class="block-th">
			<div class="dictionary">
				<img src="img/first_dictionary.jpg" alt="image">
				<div class="data">
					<button onclick='select_dictionary("100 basic verbs");'>100 basic verbs</button>
					<p>This dictionary has 100 basic verbs.</p>
				</div>
			</div>
			
			<!--
			<div class="dictionary">
				<img src="img/first_dictionary.jpg" alt="image">
				<div class="data">
					<button onclick='select_dictionary("first");'>100 basic verbs</button>
					<p>This dictionary has 100 basic verbs.</p>
				</div>
			</div>

			<div class="dictionary">
				<img src="img/first_dictionary.jpg" alt="image">
				<div class="data">
					<button onclick='select_dictionary("first");'>100 basic verbs</button>
					<p>This dictionary has 100 basic verbs.</p>				
				</div>
			</div>
		-->
	</div>
</section>
<!-- End Dictionaries section -->

<!-- Mode section -->
<section id="select_game">
	<p>Select the mode:</p>
	<button onclick="start_game_er()">En -> Ru</button>	
	<button onclick="start_game_re()">Ru -> En</button>	
</section>
<!-- End Mode section -->

<!-- Main game with words -->
<section id="game">
	<div class="parent">
		<div class="block">
			<p id="task">Translate this word:</p>
			<p id="word">word</p>
			<p id="pfs">(noun)</p>
			<form onsubmit="return false;" autocomplete="off">
				<input type="text" id="us_answer">
			</form>
			<button class="know" onclick="know_word();">know</button>
			<button onclick="select_handler();">check</button>
			<p id="counter">1/6</p>
			<div class="icons">
				<a href="#" id="lingvo" target="_blank"><img src="img/lingvo.jpg" alt="image lingvo"></a>
				<a href="#" id="forvo" target="_blank"><img src="img/forvo.jpg" alt="image forvo"></a>
				<a href="#" id="reverso" target="_blank"><img src="img/reverso.jpg" alt="image reverso"></a>
			</div>
		</div>
	</div>
</section>
<!-- End Main game with words -->

<!-- Result of the game section -->
<section id="end">
	<h1>Thank you!</h1>
	<p>Keep it up!</p>
	<p id="end_text">You have successfully completed the task </p>
	<a href="https://mcflydesigner.github.io">Go to main page</a>
</section>
<!-- End Result of the game section -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script type="text/javascript">
	addEventListener("keydown", function(event) {
		switch(event.keyCode) {
			case 13:
			if(gameWork) select_handler();
			break;

			case 16:
			if(gameWork) know_word();
			break;
		}

	});
		//We get all words from a dictionary
		//Dictionary is a JSON file
		var jsonFile = new XMLHttpRequest();
		var url = "https://mcflydesigner.github.io/words/";

		//Initialize all words from JSON file
		jsonFile.onreadystatechange = function() {
			if (jsonFile.readyState == 4 && jsonFile.status == 200) {
		  		//alert(jsonFile.responseText);
		  		set_data_er(jsonFile.responseText);
		  		set_data_re(jsonFile.responseText);
		  	}
		  }

		var game = -1; //R -> E or E -> R
		var currDict = ""; //User dictionary
		var gameWork = false; //If the user is in the game, he can press 'enter' and 'shift' in the game
		var countword = 9; //Position in the word list
		var position = 1; //User have already known words
		var allelem = 0; //All words + words where an user makes mistakes 
		var beforeend = false; //Preparing for the end of the game

		//R -> E
		var rstart = [];
		var rwords = [];
		let rcoll = new Map();
		let rpfs = new Map();

		//E -> R
		var estart = [];
		var ewords = [];
		let ecoll = new Map();
		let epfs = new Map();

		//View all dictionaries for user
		function select_dictionary(dictionary) {
			switch(dictionary) {
				case "100 basic verbs":
				currDict = "100 basic verbs";
				window.url += "100_verbs.json";
				break;

				case "second":
				currDict = "second";
				window.url += "second.json";
				break;

				default:
				currDict = "none";
				alert("Словарика еще нет :)");
				break;
			}

			jsonFile.open("GET",url,true);
			jsonFile.send();
			view_games();
		}

		function show(state) {
			document.getElementById('window').style.display = state;			
			document.getElementById('wrap').style.display = state;
		}

		//View all dictionaries for user
		function view_dictionaries() {
			$("#main").fadeOut(500);
			$("#dict").fadeIn(2000);
		}

		//Select the game
		function view_games() {
			$("#dict").fadeOut(500);
			$("#select_game").fadeIn(2000);
		}

		//Sort of word list
		function compareRandom(a, b) {
			return Math.random() - 0.5;
		}

		//Handler for either games
		function select_handler() {
			if(game == 0) game_handle_re();
			else game_handle_er();
		}



		//=============================================================
		//Russian -> English
		//=============================================================
		//Initialize all data from JSON file
		function set_data_re(datajson) {
			data = JSON.parse(datajson);

			for(var i = 0; i < data.words.length; i++) {
				window.estart.push(data.words[i][1][0]);
				ecoll.set(data.words[i][1][0], data.words[i][0]);
				var pofs = data.words[i][2];
				console.log(pofs);
				switch(pofs) {
					case "verb":
					pofs = ["гл."];
					break;

					case "noun":
					pofs = ["сущ."];
					break;

					case "adj.":
					pofs = ["прил."];
					break;

					case "adv.":
					pofs = ["нар."];
					break;

					case "num.":
					pofs = ["чис."];
					break;

					case "phrase":
					pofs = ["фраза"];
					break;

					default:
					pofs = ["не опр."];
					break;
				}
				epfs.set(data.words[i][1][0], pofs);
			}

			//Only ten words are in the list
			if(estart.length >= 10) window.ewords = window.estart.slice(0, 10);
			else window.ewords = window.estart.slice(0, estart.length);

			allelem = estart.length;
		}

		//Start game
		function start_game_re() {
			game = 0;
			document.getElementById("header").style.display = "none";
			document.getElementById("main").style.display = "none";
			document.getElementById("select_game").style.display = "none";
			document.getElementById("word").style.fontWeight = "100";
			$("#game").fadeIn(1000);

			set_word_re();
		}

		//Button "check"
		function game_handle_re() {
			var right_answer = ecoll.get(ewords[0]);
			var flag = false;

			if(document.getElementById("us_answer").value.toLowerCase().trim() == right_answer.toLowerCase()) {
				flag = true;
				ewords.push(ewords[0]);
				ewords.shift();
				document.getElementById("us_answer").style.background = "#57CE79";
				document.getElementById("us_answer").style.border = "1px solid #57CE79";
				document.getElementById("us_answer").style.color = "#fff";


				setTimeout(function () {
					set_word_re();
				}, 1500);
			}

			if(!flag) {
					//alert("false");
					//handle mistake
					document.getElementById("us_answer").value = ecoll.get(ewords[0]);
					document.getElementById("us_answer").style.background = "#D63C3C";
					document.getElementById("us_answer").style.border = "1px solid #D63C3C";
					document.getElementById("us_answer").style.color = "#fff";

					ewords.push(ewords[0]);
					ewords.push(ewords[0]);
					allelem += 1;
					ewords.shift();

					setTimeout(function () {
						set_word_re();
					}, 2000);
				} 
			}

		//Change the word
		function set_word_re() {
				//Restart game
				gameWork = true;
				//the end of the list
				if(beforeend) {
					document.getElementById("game").style.display = "none";
					gameWork = false;
					document.getElementById("end_text").innerHTML = "You have successfully completed the task \"" + currDict + "\"!";
					$("#end").fadeIn(1000);
				}
				ewords.sort(compareRandom);
				if(position == allelem) {
					beforeend = true;
				}

				document.getElementById("lingvo").href = "https://www.lingvolive.com/ru-ru/translate/en-ru/" + ecoll.get(ewords[0]);
				document.getElementById("forvo").href = "https://ru.forvo.com/word/" + ecoll.get(ewords[0]) + "/#en/";
				document.getElementById("reverso").href = "https://context.reverso.net/перевод/английский-русский/" + ecoll.get(ewords[0]);

				document.getElementById("word").innerHTML = ewords[0];
				document.getElementById("pfs").innerHTML = "(" + epfs.get(ewords[0]) + ")";
				document.getElementById("us_answer").style.background = "none";
				document.getElementById("us_answer").style.border = "1px solid black";
				document.getElementById("us_answer").style.color = "black";
				document.getElementById("us_answer").value = "";
				document.getElementById("counter").innerHTML = position + "/" + allelem;
			}

			//Button "know"
			function know_word() {
				if(game == 1) {
					document.getElementById("us_answer").style.background = "#57CE79";
					document.getElementById("us_answer").style.border = "1px solid #57CE79";
					document.getElementById("us_answer").style.color = "#fff";
					document.getElementById("us_answer").value = rcoll.get(rwords[0]).join(",");
					setTimeout(function () {
						set_word_er();
					}, 1500);
					rwords.shift();
					position++;
					if(rstart[countword + 1] != null && rwords.length < 10) {
						countword++;
						rwords.push(rstart[countword]);
					}
				} else {
					document.getElementById("us_answer").value = ecoll.get(ewords[0]);
					document.getElementById("us_answer").style.background = "#57CE79";
					document.getElementById("us_answer").style.border = "1px solid #57CE79";
					document.getElementById("us_answer").style.color = "#fff";

					setTimeout(function () {
						set_word_re();
					}, 1500);
					ewords.shift();
					position++;
					if(estart[countword + 1] != null && ewords.length < 10) {
						countword++;
						ewords.push(estart[countword]);
					}
					set_word_re();
				}
			}



		//=============================================================
		//Enlgish -> Russian
		//=============================================================
		//Initialize all data from JSON file
		function set_data_er(datajson) {
			game = 1;
			data = JSON.parse(datajson);

			for(var i = 0; i < data.words.length; i++) {
				window.rstart.push(data.words[i][0]);
				rcoll.set(data.words[i][0], data.words[i][1]);
				rpfs.set(data.words[i][0], data.words[i][2]);
			}

			//Only ten words are in the list
			if(rstart.length >= 10) window.rwords = window.rstart.slice(0, 10);
			else window.rwords = window.rstart.slice(0, rstart.length);

			allelem = rstart.length;
		}

		//Start game
		function start_game_er() {
			document.getElementById("header").style.display = "none";
			document.getElementById("main").style.display = "none";
			document.getElementById("select_game").style.display = "none";
			$("#game").fadeIn(1000);
			set_word_er();
		}


		//Button "check"
		function game_handle_er() {
			var right_answers = rcoll.get(rwords[0]);
			var flag = false;

			for(var i = 0; i < right_answers.length; i++) {
				if(document.getElementById("us_answer").value.toLowerCase().trim() == right_answers[i].toLowerCase()) {
					flag = true;
					rwords.push(rwords[0]);
					rwords.shift();

					document.getElementById("us_answer").style.background = "#57CE79";
					document.getElementById("us_answer").style.border = "1px solid #57CE79";
					document.getElementById("us_answer").style.color = "#fff";

					setTimeout(function () {
						set_word_er();
					}, 1500);

					break;
				}
			}

			if(!flag) {
					//alert("false");
					//handle a mistake
					document.getElementById("us_answer").value = rcoll.get(rwords[0]).join(",");
					document.getElementById("us_answer").style.background = "#D63C3C";
					document.getElementById("us_answer").style.border = "1px solid #D63C3C";
					document.getElementById("us_answer").style.color = "#fff";

					rwords.push(rwords[0]);
					rwords.push(rwords[0]);
					allelem += 1;
					rwords.shift();

					setTimeout(function () {
						set_word_er();
					}, 2000);
				} 
			}

			//Change the word
			function set_word_er() {
				gameWork = true;
				//the end of the list
				if(beforeend) {
					document.getElementById("game").style.display = "none";
					gameWork = false;
					document.getElementById("end_text").innerHTML = "You have successfully completed the task \"" + currDict + "\"!";
					$("#end").fadeIn(1000);
				}
				rwords.sort(compareRandom);
				if(position == allelem) {
					beforeend = true;
				}

				document.getElementById("lingvo").href = "https://www.lingvolive.com/ru-ru/translate/en-ru/" + rwords[0];
				document.getElementById("forvo").href = "https://ru.forvo.com/word/" + rwords[0] + "/#en/";
				document.getElementById("reverso").href = "https://context.reverso.net/перевод/английский-русский/" + rwords[0];

				document.getElementById("word").innerHTML = rwords[0];
				document.getElementById("pfs").innerHTML = "(" + rpfs.get(rwords[0]) + ")";
				document.getElementById("us_answer").style.background = "none";
				document.getElementById("us_answer").style.border = "1px solid black";
				document.getElementById("us_answer").style.color = "black";
				document.getElementById("us_answer").value = "";
				document.getElementById("counter").innerHTML = position + "/" + allelem;
			}


			//Animation appear
			$("#header").fadeIn(800);
			$("#main").fadeIn(1000);
		</script>
	</body>
	</html>


